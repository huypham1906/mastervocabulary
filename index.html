<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barron's 1100 Vocab Master üìö</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', Arial, sans-serif;
            background: #FFF5E1;
            color: #000;
            overflow-x: hidden;
        }

        .brutalist-box {
            background: #fff;
            border: 4px solid #000;
            box-shadow: 8px 8px 0 #000;
        }

        .brutalist-button {
            background: #FFD700;
            border: 4px solid #000;
            box-shadow: 6px 6px 0 #000;
            padding: 16px 32px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: inherit;
        }

        .brutalist-button:hover {
            transform: translate(3px, 3px);
            box-shadow: 3px 3px 0 #000;
        }

        .brutalist-button:active {
            transform: translate(6px, 6px);
            box-shadow: 0 0 0 #000;
        }

        .brutalist-button.secondary {
            background: #FF6B6B;
        }

        .brutalist-button.success {
            background: #51CF66;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: #FF6B6B;
            border-bottom: 6px solid #000;
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        h1 {
            font-size: 48px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 4px 4px 0 #000;
            color: #FFD700;
        }

        .stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: #FFD700;
            border: 4px solid #000;
            padding: 10px 20px;
            box-shadow: 4px 4px 0 #000;
        }

        .stat-label {
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }

        .menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .menu-card {
            background: #74C0FC;
            padding: 30px;
            cursor: pointer;
            transition: all 0.1s;
        }

        .menu-card:hover {
            transform: translate(4px, 4px);
            box-shadow: 4px 4px 0 #000;
        }

        .menu-card h2 {
            font-size: 28px;
            margin-bottom: 15px;
            text-transform: uppercase;
        }

        .menu-card p {
            font-size: 16px;
        }

        .menu-card .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .game-screen {
            display: none;
        }

        .game-screen.active {
            display: block;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .progress-bar {
            flex: 1;
            height: 40px;
            background: #fff;
            border: 4px solid #000;
            box-shadow: 4px 4px 0 #000;
            position: relative;
            min-width: 200px;
        }

        .progress-fill {
            height: 100%;
            background: #51CF66;
            transition: width 0.3s;
            border-right: 4px solid #000;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 16px;
        }

        .game-content {
            background: #fff;
            padding: 40px;
            margin-bottom: 30px;
        }

        .question {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
        }

        .word-display {
            font-size: 56px;
            font-weight: bold;
            text-align: center;
            color: #FF6B6B;
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .option {
            background: #74C0FC;
            border: 4px solid #000;
            padding: 25px;
            cursor: pointer;
            transition: all 0.1s;
            font-size: 18px;
            text-align: center;
            font-weight: bold;
        }

        .option:hover:not(.disabled) {
            transform: translate(4px, 4px);
            box-shadow: 4px 4px 0 #000;
        }

        .option.correct {
            background: #51CF66;
            animation: celebrate 0.5s;
        }

        .option.incorrect {
            background: #FF6B6B;
            animation: shake 0.3s;
        }

        .option.disabled {
            opacity: 0.7;
            pointer-events: none;
        }

        .matching-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .matching-column h3 {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            text-transform: uppercase;
        }

        .matching-item {
            background: #FFD700;
            border: 4px solid #000;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.1s;
            font-weight: bold;
            font-size: 16px;
        }

        .matching-item:hover:not(.matched) {
            transform: translate(2px, 2px);
            box-shadow: 4px 4px 0 #000;
        }

        .matching-item.selected {
            background: #FF6B6B;
            transform: scale(1.05);
        }

        .matching-item.matched {
            background: #51CF66;
            opacity: 0.6;
            pointer-events: none;
        }

        .story-container {
            font-size: 20px;
            line-height: 2;
            margin-bottom: 30px;
        }

        .blank-input {
            border: none;
            border-bottom: 4px solid #000;
            background: #FFD700;
            padding: 5px 15px;
            font-size: 20px;
            font-weight: bold;
            min-width: 150px;
            margin: 0 5px;
            font-family: inherit;
        }

        .blank-input:focus {
            outline: none;
            background: #74C0FC;
        }

        .blank-input.correct {
            background: #51CF66;
        }

        .blank-input.incorrect {
            background: #FF6B6B;
        }

        .word-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f0f0f0;
            border: 4px solid #000;
        }

        .word-chip {
            background: #FFD700;
            border: 3px solid #000;
            padding: 10px 20px;
            font-weight: bold;
            box-shadow: 3px 3px 0 #000;
        }

        .game-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .results {
            text-align: center;
            padding: 40px;
        }

        .results h2 {
            font-size: 48px;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .results .score {
            font-size: 72px;
            font-weight: bold;
            color: #51CF66;
            margin-bottom: 30px;
        }

        .results .message {
            font-size: 24px;
            margin-bottom: 20px;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s;
        }

        .toast {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #51CF66;
            border: 4px solid #000;
            box-shadow: 6px 6px 0 #000;
            padding: 20px 30px;
            font-weight: bold;
            font-size: 18px;
            z-index: 1000;
            animation: slideIn 0.3s;
        }

        .toast.error {
            background: #FF6B6B;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 32px;
            }

            .word-display {
                font-size: 36px;
            }

            .question {
                font-size: 24px;
            }

            .matching-grid {
                grid-template-columns: 1fr;
            }

            .game-content {
                padding: 20px;
            }
        }

        /* Daily Words Styles */
        .daily-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .daily-date {
            font-size: 24px;
            font-weight: bold;
            color: #51CF66;
            margin-bottom: 10px;
        }

        .daily-progress {
            font-size: 18px;
            color: #666;
        }

        .word-card {
            background: #fff;
            border: 4px solid #000;
            box-shadow: 6px 6px 0 #000;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.2s;
        }

        .word-card.mastered {
            background: #D3F9D8;
            opacity: 0.7;
        }

        .word-card:hover:not(.mastered) {
            transform: translate(3px, 3px);
            box-shadow: 3px 3px 0 #000;
        }

        .word-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .word-card-word {
            font-size: 32px;
            font-weight: bold;
            color: #FF6B6B;
            text-transform: uppercase;
        }

        .word-card-type {
            background: #FFD700;
            border: 3px solid #000;
            padding: 5px 15px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .word-card-meaning {
            font-size: 20px;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #333;
        }

        .word-card-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .mark-done-btn {
            background: #51CF66;
            border: 4px solid #000;
            box-shadow: 4px 4px 0 #000;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s;
            text-transform: uppercase;
            font-family: inherit;
            flex: 1;
        }

        .mark-done-btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
        }

        .mark-done-btn:active {
            transform: translate(4px, 4px);
            box-shadow: 0 0 0 #000;
        }

        .mark-done-btn.done {
            background: #D3F9D8;
            cursor: default;
            pointer-events: none;
        }

        .practice-btn {
            background: #74C0FC;
            border: 4px solid #000;
            box-shadow: 4px 4px 0 #000;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s;
            text-transform: uppercase;
            font-family: inherit;
        }

        .practice-btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
        }

        .status-badge {
            font-size: 24px;
        }

        .refresh-daily-btn {
            background: #FF6B6B;
            border: 4px solid #000;
            box-shadow: 4px 4px 0 #000;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.1s;
            text-transform: uppercase;
            font-family: inherit;
            margin: 20px auto;
            display: block;
        }

        .refresh-daily-btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
        }

        .daily-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .daily-stat-card {
            background: #FFD700;
            border: 4px solid #000;
            padding: 20px;
            text-align: center;
            box-shadow: 4px 4px 0 #000;
        }

        .daily-stat-label {
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .daily-stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #000;
        }

        /* User Profile Styles */
        .user-profile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }

        .user-profile-modal {
            background: #FFF5E1;
            border: 6px solid #000;
            box-shadow: 12px 12px 0 #000;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .user-profile-title {
            font-size: 36px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 10px;
            color: #FF6B6B;
        }

        .user-profile-subtitle {
            font-size: 18px;
            margin-bottom: 30px;
            color: #666;
        }

        .user-input {
            width: 100%;
            border: 4px solid #000;
            background: #fff;
            padding: 15px 20px;
            font-size: 20px;
            font-weight: bold;
            font-family: inherit;
            margin-bottom: 20px;
            text-align: center;
        }

        .user-input:focus {
            outline: none;
            background: #FFD700;
        }

        .user-input::placeholder {
            color: #999;
            font-weight: normal;
        }

        .user-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .user-list {
            margin: 30px 0;
            max-height: 300px;
            overflow-y: auto;
            border: 4px solid #000;
            background: #fff;
            padding: 10px;
        }

        .user-item {
            background: #74C0FC;
            border: 3px solid #000;
            padding: 15px 20px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        .user-item:hover {
            transform: translate(3px, 3px);
            box-shadow: 3px 3px 0 #000;
        }

        .user-item.active {
            background: #51CF66;
        }

        .user-stats {
            font-size: 14px;
            color: #000;
        }

        .delete-user-btn {
            background: #FF6B6B;
            border: 3px solid #000;
            padding: 5px 10px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        .delete-user-btn:hover {
            background: #FA5252;
        }

        .user-badge {
            background: #FFD700;
            border: 2px solid #000;
            padding: 3px 10px;
            font-size: 14px;
            font-weight: bold;
            margin-left: 10px;
        }

        .switch-user-btn {
            background: #74C0FC;
            border: 4px solid #000;
            box-shadow: 4px 4px 0 #000;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            font-family: inherit;
        }

        .switch-user-btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
        }

        .current-user-display {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #FFD700;
            border: 3px solid #000;
            padding: 5px 15px;
            box-shadow: 3px 3px 0 #000;
            cursor: pointer;
        }

        .current-user-display:hover {
            background: #FCC419;
        }

        .user-icon {
            font-size: 20px;
        }

        .user-name-text {
            font-weight: bold;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>üìö Vocab Master</h1>
            <div class="stats">
                <div class="current-user-display" onclick="showUserModal()" id="currentUserDisplay">
                    <span class="user-icon">üë§</span>
                    <span class="user-name-text" id="currentUserName">Guest</span>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Score</div>
                    <div class="stat-value" id="totalScore">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Learned</div>
                    <div class="stat-value" id="learnedCount">0/1100</div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="mainMenu">
            <div class="menu">
                <div class="menu-card brutalist-box" onclick="startGame('guess')">
                    <div class="icon">üéØ</div>
                    <h2>Guess the Meaning</h2>
                    <p>See a word and choose the correct definition from 4 options.</p>
                </div>

                <div class="menu-card brutalist-box" onclick="startGame('reverse')">
                    <div class="icon">üîÑ</div>
                    <h2>Reverse Match</h2>
                    <p>See a definition and find the correct word.</p>
                </div>

                <div class="menu-card brutalist-box" onclick="startGame('matching')">
                    <div class="icon">üîó</div>
                    <h2>Match Pairs</h2>
                    <p>Connect words with their correct meanings.</p>
                </div>

                <div class="menu-card brutalist-box" onclick="startGame('context')">
                    <div class="icon">üìñ</div>
                    <h2>Context Master</h2>
                    <p>Fill in the blanks in a story with vocabulary words.</p>
                </div>

                <div class="menu-card brutalist-box" onclick="startGame('speed')">
                    <div class="icon">‚ö°</div>
                    <h2>Speed Round</h2>
                    <p>Quick-fire questions. How many can you get right?</p>
                </div>

                <div class="menu-card brutalist-box" onclick="startGame('idioms')">
                    <div class="icon">üí¨</div>
                    <h2>Idiom Hunter</h2>
                    <p>Learn common phrases and their meanings.</p>
                </div>

                <div class="menu-card brutalist-box" onclick="startGame('daily')" style="background: #51CF66;">
                    <div class="icon">üìÖ</div>
                    <h2>Daily Words</h2>
                    <p>Learn 10 random words each day. Mark done when mastered!</p>
                </div>
            </div>
        </div>

        <div id="guessGame" class="game-screen"></div>
        <div id="dailyGame" class="game-screen"></div>
        <div id="reverseGame" class="game-screen"></div>
        <div id="matchingGame" class="game-screen"></div>
        <div id="contextGame" class="game-screen"></div>
        <div id="speedGame" class="game-screen"></div>
        <div id="idiomsGame" class="game-screen"></div>
    </div>

    <script>
        // This includes a comprehensive selection of the 1100 words
        // For the full version, all 1100 words would be included
        const vocabData = [
            { word: "abhor", meaning: "to utterly hate", type: "word" },
            { word: "abjure", meaning: "abstain from, renounce", type: "word" },
            { word: "abortive", meaning: "fruitless, failing", type: "word" },
            { word: "abound", meaning: "to exist in great numbers", type: "word" },
            { word: "abrogate", meaning: "repeal by law", type: "word" },
            { word: "abstemious", meaning: "moderate in eating or drinking", type: "word" },
            { word: "absurd", meaning: "ridiculous", type: "word" },
            { word: "access", meaning: "admittance", type: "word" },
            { word: "accommodate", meaning: "to make fit, adjust to", type: "word" },
            { word: "accomplice", meaning: "an associate in crime", type: "word" },
            { word: "accost", meaning: "to greet first; to approach and speak to", type: "word" },
            { word: "acknowledge", meaning: "admit", type: "word" },
            { word: "acme", meaning: "zenith, pinnacle, peak", type: "word" },
            { word: "acrimonious", meaning: "caustic, bitter", type: "word" },
            { word: "acute", meaning: "severe, keen, sharp", type: "word" },
            { word: "adamant", meaning: "inflexible, unyielding", type: "word" },
            { word: "adherent", meaning: "supporter, backer", type: "word" },
            { word: "admonish", meaning: "to scold, warn", type: "word" },
            { word: "adroit", meaning: "clever; skillful", type: "word" },
            { word: "advent", meaning: "coming of an important event", type: "word" },
            { word: "adversary", meaning: "enemy, foe, opponent", type: "word" },
            { word: "adverse", meaning: "unfavorable", type: "word" },
            { word: "advocate", meaning: "to support", type: "word" },
            { word: "aegis", meaning: "protection, sponsorship, shield", type: "word" },
            { word: "afflict", meaning: "to trouble greatly", type: "word" },
            { word: "affluent", meaning: "wealthy", type: "word" },
            { word: "alacrity", meaning: "quick willingness", type: "word" },
            { word: "allay", meaning: "soothe, calm", type: "word" },
            { word: "alleged", meaning: "supposed, reported", type: "word" },
            { word: "alleviate", meaning: "lighten, make easier", type: "word" },
            { word: "allude", meaning: "suggest, hint", type: "word" },
            { word: "aloof", meaning: "reserved, apart, distant", type: "word" },
            { word: "altruistic", meaning: "unselfish", type: "word" },
            { word: "ambiguous", meaning: "undefined, vague, not specific", type: "word" },
            { word: "ameliorate", meaning: "relieve, improve", type: "word" },
            { word: "amicable", meaning: "friendly", type: "word" },
            { word: "amnesty", meaning: "a general pardon", type: "word" },
            { word: "amorous", meaning: "full of love", type: "word" },
            { word: "analogous", meaning: "comparable, similar", type: "word" },
            { word: "anathema", meaning: "a curse", type: "word" },
            { word: "annals", meaning: "historical records", type: "word" },
            { word: "anomaly", meaning: "abnormality, irregularity", type: "word" },
            { word: "anthropologist", meaning: "person who studies mankind's customs", type: "word" },
            { word: "antipathy", meaning: "hate, distaste, dislike", type: "word" },
            { word: "antiquated", meaning: "out-of-date, obsolete", type: "word" },
            { word: "antithesis", meaning: "exact opposite", type: "word" },
            { word: "apathy", meaning: "unconcern, lack of interest", type: "word" },
            { word: "appalled", meaning: "shocked, dismayed", type: "word" },
            { word: "appellation", meaning: "a name", type: "word" },
            { word: "arbiter", meaning: "judge", type: "word" },
            { word: "arbitrary", meaning: "based on whim", type: "word" },
            { word: "archaic", meaning: "out of date", type: "word" },
            { word: "ardent", meaning: "eager, passionate", type: "word" },
            { word: "array", meaning: "system, arrangement", type: "word" },
            { word: "artifact", meaning: "a hand-made object", type: "word" },
            { word: "artifice", meaning: "strategy, trickery", type: "word" },
            { word: "artless", meaning: "naive, innocent", type: "word" },
            { word: "ascend", meaning: "to rise", type: "word" },
            { word: "ascertain", meaning: "find out about, discover", type: "word" },
            { word: "ascetic", meaning: "one who practices self-denial", type: "word" },
            { word: "asinine", meaning: "stupid, silly", type: "word" },
            { word: "asperity", meaning: "bitterness of temper", type: "word" },
            { word: "aspirant", meaning: "candidate for better job", type: "word" },
            { word: "aspire", meaning: "to strive for", type: "word" },
            { word: "asset", meaning: "something of value", type: "word" },
            { word: "assiduous", meaning: "busy, attentive", type: "word" },
            { word: "astute", meaning: "keen, shrewd", type: "word" },
            { word: "atrophy", meaning: "waste away", type: "word" },
            { word: "attenuated", meaning: "decreased, weakened, thinned", type: "word" },
            { word: "attest", meaning: "confirm as accurate, vouch for", type: "word" },
            { word: "atypical", meaning: "nonconforming", type: "word" },
            { word: "audacity", meaning: "daring, boldness", type: "word" },
            { word: "augment", meaning: "increase, enlarge", type: "word" },
            { word: "austere", meaning: "unadorned, simple, hard", type: "word" },
            { word: "automaton", meaning: "a robot; a mechanical person", type: "word" },
            { word: "avarice", meaning: "passion for riches, greed", type: "word" },
            { word: "aversion", meaning: "opposition, strong dislike", type: "word" },
            { word: "avid", meaning: "enthusiastic; eager", type: "word" },
            { word: "awesome", meaning: "inspiring terror, weird", type: "word" },
            { word: "badger", meaning: "to pester; nag; annoy persistently", type: "word" },
            { word: "bagatelle", meaning: "a trifle", type: "word" },
            { word: "balk", meaning: "to refuse to move", type: "word" },
            { word: "banal", meaning: "meaningless from overuse, trivial", type: "word" },
            { word: "barometer", meaning: "instrument for measuring change", type: "word" },
            { word: "bedlam", meaning: "uproar, confusion", type: "word" },
            { word: "begrudge", meaning: "to be resentful or reluctant", type: "word" },
            { word: "belated", meaning: "delayed, late", type: "word" },
            { word: "belittle", meaning: "speak of as unimportant", type: "word" },
            { word: "belligerent", meaning: "seeking war, hostile", type: "word" },
            { word: "benevolent", meaning: "charitable, kindly", type: "word" },
            { word: "bereft", meaning: "deprived of", type: "word" },
            { word: "besiege", meaning: "to surround", type: "word" },
            { word: "besmirch", meaning: "stain, soil, dim the reputation", type: "word" },
            { word: "bias", meaning: "prejudice", type: "word" },
            { word: "bigot", meaning: "prejudiced person", type: "word" },
            { word: "bizarre", meaning: "weird", type: "word" },
            { word: "blase", meaning: "indifferent, not responsive to excitement", type: "word" },
            { word: "blatant", meaning: "disagreeably loud", type: "word" },
            { word: "bliss", meaning: "pleasure, happiness", type: "word" },
            { word: "blunt", meaning: "plain spoken", type: "word" },
            { word: "bogus", meaning: "fake, counterfeit", type: "word" },
            { word: "brash", meaning: "insolent", type: "word" },
            { word: "brigand", meaning: "bandit, robber", type: "word" },
            { word: "bristle", meaning: "to have one's hair stand up", type: "word" },
            { word: "bulwark", meaning: "protection", type: "word" },
            { word: "burgeoned", meaning: "grew, flourished", type: "word" },
            { word: "cache", meaning: "secret hiding place", type: "word" },
            { word: "cacophony", meaning: "harsh sound, discord, dissonance", type: "word" },
            { word: "cajole", meaning: "coax; wheedle", type: "word" },
            { word: "callous", meaning: "unfeeling, hardened", type: "word" },
            { word: "callow", meaning: "inexperienced, youthful", type: "word" },
            { word: "calumny", meaning: "slander, false accusation", type: "word" },
            { word: "canard", meaning: "a made-up sensational story", type: "word" },
            { word: "candid", meaning: "open, honest, frank", type: "word" },
            { word: "candor", meaning: "honesty, frankness", type: "word" },
            { word: "cant", meaning: "insincere or almost meaningless talk", type: "word" },
            { word: "capitulate", meaning: "make terms, surrender", type: "word" },
            { word: "capricious", meaning: "fanciful, whimsical", type: "word" },
            { word: "carnage", meaning: "slaughter", type: "word" },
            { word: "castigate", meaning: "punish, chastise", type: "word" },
            { word: "catastrophic", meaning: "disastrous", type: "word" },
            { word: "caustic", meaning: "stinging", type: "word" },
            { word: "celerity", meaning: "rapidity, speed", type: "word" },
            { word: "cessation", meaning: "a pause", type: "word" },
            { word: "chagrin", meaning: "disappointment", type: "word" },
            { word: "charisma", meaning: "quality of leadership inspiring enthusiasm", type: "word" },
            { word: "charlatan", meaning: "fraud, pretender", type: "word" },
            { word: "chicanery", meaning: "underhandedness, trickery", type: "word" },
            { word: "chimerical", meaning: "imaginary, fantastic", type: "word" },
            { word: "clandestine", meaning: "hidden, secret", type: "word" },
            { word: "cliche", meaning: "a commonplace phrase", type: "word" },
            { word: "clique", meaning: "small, exclusive group of people", type: "word" },
            { word: "coerce", meaning: "to force", type: "word" },
            { word: "cogent", meaning: "forceful, convincing, persuasive", type: "word" },
            { word: "cognizant", meaning: "aware", type: "word" },
            { word: "comely", meaning: "handsome, beautiful", type: "word" },
            { word: "commodious", meaning: "spacious, large", type: "word" },
            { word: "compassion", meaning: "kindness, sympathetic feeling", type: "word" },
            { word: "compatible", meaning: "well-matched, harmonious", type: "word" },
            { word: "compensatory", meaning: "serving to pay back", type: "word" },
            { word: "complacent", meaning: "self-satisfied", type: "word" },
            { word: "complicity", meaning: "partnership in wrongdoing", type: "word" },
            { word: "component", meaning: "element, part", type: "word" },
            { word: "compound", meaning: "to increase or add to", type: "word" },
            { word: "comprehensive", meaning: "thorough", type: "word" },
            { word: "concoct", meaning: "devise", type: "word" },
            { word: "concomitant", meaning: "attending, accompanying", type: "word" },
            { word: "concur", meaning: "agree", type: "word" },
            { word: "condescend", meaning: "lower oneself, stoop", type: "word" },
            { word: "condolence", meaning: "expression of sympathy", type: "word" },
            { word: "condone", meaning: "pardon, excuse", type: "word" },
            { word: "conductive", meaning: "leading, helpful", type: "word" },
            { word: "confidant", meaning: "person you tell your secrets to", type: "word" },
            { word: "conflagration", meaning: "great fire", type: "word" },
            { word: "confront", meaning: "come face to face with", type: "word" },
            { word: "congenial", meaning: "agreeable, sympathetic", type: "word" },
            { word: "conjecture", meaning: "guess", type: "word" },
            { word: "conjugal", meaning: "relating to marriage, connubial", type: "word" },
            { word: "connoisseur", meaning: "expert", type: "word" },
            { word: "connubial", meaning: "related to marriage", type: "word" },
            { word: "consternation", meaning: "dread, dismay", type: "word" },
            { word: "constrict", meaning: "bind, limit, squeeze", type: "word" },
            { word: "construe", meaning: "to interpret", type: "word" },
            { word: "consummate", meaning: "perfect, complete", type: "word" },
            { word: "contemptuous", meaning: "looking down on someone or something", type: "word" },
            { word: "contort", meaning: "twist violently", type: "word" },
            { word: "controversial", meaning: "debatable", type: "word" },
            { word: "cope", meaning: "to be a match for", type: "word" },
            { word: "copious", meaning: "plentiful, abundant, ample", type: "word" },
            { word: "corpulent", meaning: "excessively fat, fleshy, obese", type: "word" },
            { word: "corroborate", meaning: "confirm", type: "word" },
            { word: "coterie", meaning: "small exclusive group", type: "word" },
            { word: "countenance", meaning: "approve, tolerate", type: "word" },
            { word: "coup", meaning: "revolution, overthrow", type: "word" },
            { word: "covert", meaning: "secret", type: "word" },
            { word: "covet", meaning: "wish, envy, want", type: "word" },
            { word: "crave", meaning: "to desire", type: "word" },
            { word: "criterion", meaning: "test, model, standard", type: "word" },
            { word: "cryptic", meaning: "puzzling", type: "word" },
            { word: "culminate", meaning: "reach the highest point", type: "word" },
            { word: "culpable", meaning: "deserving blame", type: "word" },
            { word: "culprit", meaning: "one who commits a crime", type: "word" },
            { word: "cumbersome", meaning: "burdensome, unwieldy", type: "word" },
            { word: "cumulative", meaning: "accumulated", type: "word" },
            { word: "cupidity", meaning: "greed", type: "word" },
            { word: "curry", meaning: "to seek favor by flattery", type: "word" },
            { word: "cursory", meaning: "not thorough, hasty", type: "word" },
            { word: "curtail", meaning: "cut short", type: "word" },
            { word: "cynic", meaning: "skeptic, pessimist", type: "word" },
            
            // Idioms
            { word: "a blind alley", meaning: "a direction that leads nowhere", type: "idiom" },
            { word: "a bolt from the blue", meaning: "a great surprise", type: "idiom" },
            { word: "a cat's paw", meaning: "a person used as a tool or dupe", type: "idiom" },
            { word: "a feather in one's cap", meaning: "something to be proud of", type: "idiom" },
            { word: "a flash in the pan", meaning: "promising at the start but then disappointing", type: "idiom" },
            { word: "a fly in the ointment", meaning: "something that spoils or lessens the enjoyment", type: "idiom" },
            { word: "a lick and a promise", meaning: "to do something in a hasty and superficial manner", type: "idiom" },
            { word: "a pig in a poke", meaning: "an item you purchase without having seen; a disappointment", type: "idiom" },
            { word: "a pretty kettle of fish", meaning: "a mess, trouble", type: "idiom" },
            { word: "a red herring", meaning: "something that diverts attention from the main issue", type: "idiom" },
            { word: "a sacred cow", meaning: "a person who cannot be criticized", type: "idiom" },
            { word: "a square peg in a round hole", meaning: "an able man in the wrong job", type: "idiom" },
            { word: "a wet blanket", meaning: "one who spoils the fun; killjoy; spoilsport", type: "idiom" },
            { word: "a white elephant", meaning: "a costly and useless possession", type: "idiom" },
            { word: "Achilles heel", meaning: "weak spot", type: "idiom" },
            { word: "an ax to grind", meaning: "having a selfish motive in the background", type: "idiom" },
            { word: "apple polishing", meaning: "trying to gain favor by gifts or flattery", type: "idiom" },
            { word: "behind the eight ball", meaning: "in trouble", type: "idiom" },
            { word: "bitter pill to swallow", meaning: "a humiliating defeat", type: "idiom" },
            { word: "blue chip", meaning: "a highly valuable asset, stock, or property", type: "idiom" },
            { word: "brass tacks", meaning: "the real problem or situation", type: "idiom" },
            { word: "bring home the bacon", meaning: "to earn a living, to succeed", type: "idiom" },
            { word: "burn the midnight oil", meaning: "study or work late into the night", type: "idiom" },
            { word: "bury the hatchet", meaning: "to make peace", type: "idiom" },
            { word: "by hook or by crook", meaning: "at any cost, any way at all", type: "idiom" },
            { word: "chip off the old block", meaning: "a son who is like his father", type: "idiom" },
            { word: "cold feet", meaning: "to hesitate because of fear or uncertainty", type: "idiom" },
            { word: "cold shoulder", meaning: "to disregard or ignore", type: "idiom" },
            { word: "crocodile tears", meaning: "insincere tears", type: "idiom" },
            { word: "fair-weather friends", meaning: "unreliable, they fail one in time of distress", type: "idiom" }
        ];

        // User System
        let currentUser = null;
        let allUsers = JSON.parse(localStorage.getItem('allUsers') || '{}');
        
        // Game State
        let currentGame = null;
        let currentQuestion = 0;
        let score = 0;
        let totalScore = 0;
        let learnedWords = new Set();
        let masteredWords = new Set();
        let gameWords = [];
        let selectedMatches = [];
        let dailyWords = [];
        let dailyDate = '';

        // Initialize user system
        initUserSystem();

        function initUserSystem() {
            // Check if there's a last active user
            const lastUser = localStorage.getItem('lastActiveUser');
            
            if (lastUser && allUsers[lastUser]) {
                // Load last user
                switchToUser(lastUser);
            } else if (Object.keys(allUsers).length > 0) {
                // Load first available user
                const firstUser = Object.keys(allUsers)[0];
                switchToUser(firstUser);
            } else {
                // Show user creation modal for first time
                showUserModal(true);
            }
        }

        function getUserData(username) {
            if (!allUsers[username]) {
                allUsers[username] = {
                    name: username,
                    totalScore: 0,
                    learnedWords: [],
                    masteredWords: [],
                    dailyWords: [],
                    dailyDate: '',
                    createdAt: new Date().toISOString()
                };
                saveAllUsers();
            }
            return allUsers[username];
        }

        function saveAllUsers() {
            localStorage.setItem('allUsers', JSON.stringify(allUsers));
        }

        function saveCurrentUserData() {
            if (!currentUser) return;
            
            allUsers[currentUser] = {
                ...allUsers[currentUser],
                totalScore: totalScore,
                learnedWords: [...learnedWords],
                masteredWords: [...masteredWords],
                dailyWords: dailyWords,
                dailyDate: dailyDate
            };
            saveAllUsers();
        }

        function switchToUser(username) {
            currentUser = username;
            const userData = getUserData(username);
            
            // Load user data into game state
            totalScore = userData.totalScore || 0;
            learnedWords = new Set(userData.learnedWords || []);
            masteredWords = new Set(userData.masteredWords || []);
            dailyWords = userData.dailyWords || [];
            dailyDate = userData.dailyDate || '';
            
            // Save as last active user
            localStorage.setItem('lastActiveUser', username);
            
            // Update UI
            updateStats();
            updateUserDisplay();
            
            // Reinitialize daily words for this user
            initDailyWords();
        }

        function updateUserDisplay() {
            const userNameEl = document.getElementById('currentUserName');
            if (userNameEl && currentUser) {
                userNameEl.textContent = currentUser;
            }
        }

        function showUserModal(isFirstTime = false) {
            const overlay = document.createElement('div');
            overlay.className = 'user-profile-overlay';
            overlay.id = 'userModal';
            
            const userList = Object.keys(allUsers).map(username => {
                const user = allUsers[username];
                const isActive = username === currentUser;
                return `
                    <div class="user-item ${isActive ? 'active' : ''}" onclick="selectUser('${username}')">
                        <div>
                            <strong>${username}</strong>
                            ${isActive ? '<span class="user-badge">ACTIVE</span>' : ''}
                            <div class="user-stats">
                                ${user.masteredWords?.length || 0}/1100 words ‚Ä¢ ${user.totalScore || 0} pts
                            </div>
                        </div>
                        ${!isActive ? `<button class="delete-user-btn" onclick="event.stopPropagation(); deleteUser('${username}')">üóëÔ∏è Delete</button>` : ''}
                    </div>
                `;
            }).join('');
            
            overlay.innerHTML = `
                <div class="user-profile-modal">
                    <div class="user-profile-title">üë§ User Profile</div>
                    <div class="user-profile-subtitle">
                        ${isFirstTime ? 'Welcome! Create your profile to start learning' : 'Switch user or create new profile'}
                    </div>
                    
                    <input 
                        type="text" 
                        class="user-input" 
                        id="usernameInput" 
                        placeholder="Enter your name..."
                        maxlength="20"
                    />
                    
                    <button class="brutalist-button success" onclick="createOrSwitchUser()" style="width: 100%;">
                        ‚úì Create / Login
                    </button>
                    
                    ${Object.keys(allUsers).length > 0 ? `
                        <div style="margin: 20px 0; font-weight: bold; text-transform: uppercase;">
                            Or select existing user:
                        </div>
                        <div class="user-list">
                            ${userList}
                        </div>
                    ` : ''}
                    
                    <div class="user-buttons">
                        ${!isFirstTime ? `
                            <button class="brutalist-button secondary" onclick="closeUserModal()" style="flex: 1;">
                                Cancel
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Focus input
            setTimeout(() => {
                const input = document.getElementById('usernameInput');
                if (input) {
                    input.focus();
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            createOrSwitchUser();
                        }
                    });
                }
            }, 100);
        }

        function createOrSwitchUser() {
            const input = document.getElementById('usernameInput');
            const username = input.value.trim();
            
            if (!username) {
                showToast('Please enter a name!', true);
                return;
            }
            
            if (username.length < 2) {
                showToast('Name must be at least 2 characters!', true);
                return;
            }
            
            // Check if user exists
            if (allUsers[username]) {
                // Switch to existing user
                switchToUser(username);
                showToast(`Welcome back, ${username}! üëã`);
            } else {
                // Create new user
                getUserData(username); // This creates the user
                switchToUser(username);
                showToast(`Profile created! Welcome, ${username}! üéâ`);
            }
            
            closeUserModal();
            
            // Refresh UI
            if (currentGame === 'daily') {
                startDailyWordsGame();
            }
        }

        function selectUser(username) {
            switchToUser(username);
            showToast(`Switched to ${username}! üëã`);
            closeUserModal();
            
            // Refresh UI
            if (currentGame === 'daily') {
                startDailyWordsGame();
            }
        }

        function deleteUser(username) {
            if (!confirm(`Are you sure you want to delete ${username}'s profile?\n\nThis will erase all progress permanently!`)) {
                return;
            }
            
            delete allUsers[username];
            saveAllUsers();
            
            // If deleting current user, switch to another or create new
            if (currentUser === username) {
                const remainingUsers = Object.keys(allUsers);
                if (remainingUsers.length > 0) {
                    switchToUser(remainingUsers[0]);
                } else {
                    currentUser = null;
                    showUserModal(true);
                }
            }
            
            showToast(`${username}'s profile deleted! üóëÔ∏è`);
            
            // Refresh modal
            closeUserModal();
            setTimeout(() => showUserModal(), 100);
        }

        function closeUserModal() {
            const modal = document.getElementById('userModal');
            if (modal) {
                modal.remove();
            }
        }

        updateStats();
        initDailyWords();

        function shuffleArray(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function getRandomWords(count, type = 'word') {
            const filtered = vocabData.filter(v => v.type === type);
            return shuffleArray(filtered).slice(0, Math.min(count, filtered.length));
        }

        function updateStats() {
            document.getElementById('totalScore').textContent = totalScore;
            document.getElementById('learnedCount').textContent = `${masteredWords.size}/1100`;
        }

        function saveProgress() {
            saveCurrentUserData();
        }

        function showToast(message, isError = false) {
            const toast = document.createElement('div');
            toast.className = 'toast' + (isError ? ' error' : '');
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        function hideAllGames() {
            document.querySelectorAll('.game-screen').forEach(el => el.classList.remove('active'));
            document.getElementById('mainMenu').style.display = 'none';
        }

        function showMenu() {
            hideAllGames();
            document.getElementById('mainMenu').style.display = 'block';
            currentGame = null;
        }

        function startGame(gameType) {
            hideAllGames();
            currentQuestion = 0;
            score = 0;
            
            switch(gameType) {
                case 'guess':
                    startGuessGame();
                    break;
                case 'reverse':
                    startReverseGame();
                    break;
                case 'matching':
                    startMatchingGame();
                    break;
                case 'context':
                    startContextGame();
                    break;
                case 'speed':
                    startSpeedGame();
                    break;
                case 'idioms':
                    startIdiomsGame();
                    break;
                case 'daily':
                    startDailyWordsGame();
                    break;
            }
        }

        // Guess Game
        function startGuessGame() {
            currentGame = 'guess';
            gameWords = getRandomWords(20);
            document.getElementById('guessGame').classList.add('active');
            showGuessQuestion();
        }

        function showGuessQuestion() {
            if (currentQuestion >= gameWords.length) {
                showResults('guessGame');
                return;
            }

            const word = gameWords[currentQuestion];
            const wrongAnswers = getRandomWords(3).filter(w => w.word !== word.word);
            const options = shuffleArray([...wrongAnswers, word]);

            const html = `
                <div class="game-header">
                    <button class="brutalist-button secondary" onclick="showMenu()">‚Üê Back</button>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(currentQuestion / gameWords.length) * 100}%"></div>
                        <div class="progress-text">${currentQuestion + 1} / ${gameWords.length}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Score</div>
                        <div class="stat-value">${score}</div>
                    </div>
                </div>

                <div class="game-content brutalist-box fade-in">
                    <div class="question">What does this word mean?</div>
                    <div class="word-display">${word.word}</div>
                    <div class="options">
                        ${options.map((opt, i) => `
                            <div class="option" onclick="checkGuessAnswer('${opt.word.replace(/'/g, "\\'")}', '${word.word.replace(/'/g, "\\'")}', this)">
                                ${opt.meaning}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            document.getElementById('guessGame').innerHTML = html;
        }

        function checkGuessAnswer(selected, correct, element) {
            const options = document.querySelectorAll('#guessGame .option');
            options.forEach(opt => opt.classList.add('disabled'));

            if (selected === correct) {
                element.classList.add('correct');
                score += 10;
                totalScore += 10;
                learnedWords.add(correct);
                masteredWords.add(correct); // Also mark as mastered
                showToast('Correct! +10 points');
            } else {
                element.classList.add('incorrect');
                options.forEach(opt => {
                    const vocabItem = vocabData.find(v => v.word === correct);
                    if (vocabItem && opt.textContent.trim() === vocabItem.meaning) {
                        opt.classList.add('correct');
                    }
                });
                showToast('Incorrect!', true);
            }

            saveProgress();
            updateStats();

            setTimeout(() => {
                currentQuestion++;
                showGuessQuestion();
            }, 1500);
        }

        // Reverse Game
        function startReverseGame() {
            currentGame = 'reverse';
            gameWords = getRandomWords(20);
            document.getElementById('reverseGame').classList.add('active');
            showReverseQuestion();
        }

        function showReverseQuestion() {
            if (currentQuestion >= gameWords.length) {
                showResults('reverseGame');
                return;
            }

            const word = gameWords[currentQuestion];
            const wrongAnswers = getRandomWords(3).filter(w => w.word !== word.word);
            const options = shuffleArray([...wrongAnswers, word]);

            const html = `
                <div class="game-header">
                    <button class="brutalist-button secondary" onclick="showMenu()">‚Üê Back</button>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(currentQuestion / gameWords.length) * 100}%"></div>
                        <div class="progress-text">${currentQuestion + 1} / ${gameWords.length}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Score</div>
                        <div class="stat-value">${score}</div>
                    </div>
                </div>

                <div class="game-content brutalist-box fade-in">
                    <div class="question">Which word matches this definition?</div>
                    <div class="word-display" style="font-size: 28px; text-transform: none;">${word.meaning}</div>
                    <div class="options">
                        ${options.map((opt, i) => `
                            <div class="option" onclick="checkReverseAnswer('${opt.word.replace(/'/g, "\\'")}', '${word.word.replace(/'/g, "\\'")}', this)">
                                ${opt.word}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            document.getElementById('reverseGame').innerHTML = html;
        }

        function checkReverseAnswer(selected, correct, element) {
            const options = document.querySelectorAll('#reverseGame .option');
            options.forEach(opt => opt.classList.add('disabled'));

            if (selected === correct) {
                element.classList.add('correct');
                score += 10;
                totalScore += 10;
                learnedWords.add(correct);
                masteredWords.add(correct);
                showToast('Correct! +10 points');
            } else {
                element.classList.add('incorrect');
                options.forEach(opt => {
                    if (opt.textContent.trim() === correct) {
                        opt.classList.add('correct');
                    }
                });
                showToast('Incorrect!', true);
            }

            saveProgress();
            updateStats();

            setTimeout(() => {
                currentQuestion++;
                showReverseQuestion();
            }, 1500);
        }

        // Matching Game
        function startMatchingGame() {
            currentGame = 'matching';
            gameWords = getRandomWords(10);
            selectedMatches = [];
            document.getElementById('matchingGame').classList.add('active');
            showMatchingGame();
        }

        function showMatchingGame() {
            const words = shuffleArray([...gameWords]);
            const meanings = shuffleArray(gameWords.map(w => ({ word: w.word, meaning: w.meaning })));

            const html = `
                <div class="game-header">
                    <button class="brutalist-button secondary" onclick="showMenu()">‚Üê Back</button>
                    <div class="stat-box">
                        <div class="stat-label">Matched</div>
                        <div class="stat-value" id="matchedCount">0 / ${gameWords.length}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Score</div>
                        <div class="stat-value">${score}</div>
                    </div>
                </div>

                <div class="game-content brutalist-box fade-in">
                    <div class="question">Match the words with their meanings</div>
                    <div class="matching-grid">
                        <div class="matching-column">
                            <h3>Words</h3>
                            ${words.map(w => `
                                <div class="matching-item" data-word="${w.word.replace(/"/g, '&quot;')}" onclick="selectMatch(this, 'word')">
                                    ${w.word}
                                </div>
                            `).join('')}
                        </div>
                        <div class="matching-column">
                            <h3>Meanings</h3>
                            ${meanings.map(m => `
                                <div class="matching-item" data-word="${m.word.replace(/"/g, '&quot;')}" onclick="selectMatch(this, 'meaning')">
                                    ${m.meaning}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('matchingGame').innerHTML = html;
        }

        function selectMatch(element, type) {
            if (element.classList.contains('matched')) return;

            document.querySelectorAll(`#matchingGame .matching-item.selected`).forEach(el => {
                const isWordColumn = el.closest('.matching-column').querySelector('h3').textContent === 'Words';
                const isSameType = (type === 'word' && isWordColumn) || (type === 'meaning' && !isWordColumn);
                if (isSameType) {
                    el.classList.remove('selected');
                }
            });

            element.classList.add('selected');

            const selected = document.querySelectorAll('#matchingGame .matching-item.selected');
            if (selected.length === 2) {
                const word1 = selected[0].dataset.word;
                const word2 = selected[1].dataset.word;

                if (word1 === word2) {
                    selected.forEach(el => {
                        el.classList.remove('selected');
                        el.classList.add('matched');
                    });
                    score += 15;
                    totalScore += 15;
                    learnedWords.add(word1);
                    masteredWords.add(word1);
                    
                    const matchedCount = document.querySelectorAll('#matchingGame .matching-item.matched').length / 2;
                    document.getElementById('matchedCount').textContent = `${matchedCount} / ${gameWords.length}`;
                    
                    showToast('Match! +15 points');
                    saveProgress();
                    updateStats();

                    if (matchedCount === gameWords.length) {
                        setTimeout(() => showResults('matchingGame'), 1000);
                    }
                } else {
                    showToast('Not a match!', true);
                    setTimeout(() => {
                        selected.forEach(el => el.classList.remove('selected'));
                    }, 500);
                }
            }
        }

        // Context Game
        function startContextGame() {
            currentGame = 'context';
            gameWords = getRandomWords(25);
            currentQuestion = 0;
            document.getElementById('contextGame').classList.add('active');
            showContextGame();
        }

        function showContextGame() {
            const story = generateStory(gameWords.slice(currentQuestion, currentQuestion + 5));
            
            const html = `
                <div class="game-header">
                    <button class="brutalist-button secondary" onclick="showMenu()">‚Üê Back</button>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(currentQuestion / 25) * 100}%"></div>
                        <div class="progress-text">${Math.min(currentQuestion + 5, 25)} / 25</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Score</div>
                        <div class="stat-value">${score}</div>
                    </div>
                </div>

                <div class="game-content brutalist-box fade-in">
                    <div class="question">Fill in the blanks with the correct words</div>
                    <div class="word-bank">
                        ${story.words.map(w => `<div class="word-chip">${w}</div>`).join('')}
                    </div>
                    <div class="story-container" id="storyText">
                        ${story.text}
                    </div>
                    <div class="game-actions">
                        <button class="brutalist-button success" onclick="checkContextAnswers()">Check Answers</button>
                    </div>
                </div>
            `;

            document.getElementById('contextGame').innerHTML = html;
        }

        function generateStory(words) {
            const templates = [
                `The scholar was known for being extremely {0}, dedicating countless hours to research. However, his {1} personality made him unpopular with colleagues. Despite this, his work remained {2} in the field. When critics tried to {3} his findings, he remained {4}, refusing to back down from his position.`,
                
                `In the {0} mansion, the {1} owner displayed his wealth through {2} decorations. His {3} behavior often {4} his guests, who found his constant boasting unbearable.`,
                
                `The CEO's {0} decision-making led to {1} consequences for the company. Employees felt {2} by the sudden changes, while investors grew increasingly {3}. The board attempted to {4} the situation, but their efforts proved futile.`
            ];

            const template = templates[Math.floor(Math.random() * templates.length)];
            let text = template;
            const usedWords = [];

            for (let i = 0; i < words.length && i < 6; i++) {
                const placeholder = `{${i}}`;
                if (text.includes(placeholder)) {
                    text = text.replace(placeholder, `<input type="text" class="blank-input" data-answer="${words[i].word}" placeholder="___" />`);
                    usedWords.push(words[i].word);
                }
            }

            return {
                text: text,
                words: shuffleArray(usedWords)
            };
        }

        function checkContextAnswers() {
            const inputs = document.querySelectorAll('#contextGame .blank-input');
            let correct = 0;

            inputs.forEach(input => {
                const userAnswer = input.value.trim().toLowerCase();
                const correctAnswer = input.dataset.answer.toLowerCase();

                if (userAnswer === correctAnswer) {
                    input.classList.add('correct');
                    input.classList.remove('incorrect');
                    correct++;
                    learnedWords.add(input.dataset.answer);
                    masteredWords.add(input.dataset.answer);
                } else {
                    input.classList.add('incorrect');
                    input.classList.remove('correct');
                }
            });

            const points = correct * 8;
            score += points;
            totalScore += points;
            saveProgress();
            updateStats();

            showToast(`${correct}/${inputs.length} correct! +${points} points`);

            setTimeout(() => {
                currentQuestion += 5;
                if (currentQuestion >= 25) {
                    showResults('contextGame');
                } else {
                    showContextGame();
                }
            }, 2000);
        }

        // Speed Game
        function startSpeedGame() {
            currentGame = 'speed';
            gameWords = getRandomWords(30);
            currentQuestion = 0;
            score = 0;
            document.getElementById('speedGame').classList.add('active');
            showSpeedQuestion();
        }

        function showSpeedQuestion() {
            if (currentQuestion >= gameWords.length) {
                showResults('speedGame');
                return;
            }

            const word = gameWords[currentQuestion];
            const wrongAnswers = getRandomWords(3).filter(w => w.word !== word.word);
            const options = shuffleArray([...wrongAnswers, word]);

            const html = `
                <div class="game-header">
                    <button class="brutalist-button secondary" onclick="showMenu()">‚Üê Back</button>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(currentQuestion / gameWords.length) * 100}%"></div>
                        <div class="progress-text">${currentQuestion + 1} / ${gameWords.length}</div>
                    </div>
                    <div class="stat-box" style="background: #FF6B6B;">
                        <div class="stat-label">‚ö° SPEED</div>
                        <div class="stat-value">${score}</div>
                    </div>
                </div>

                <div class="game-content brutalist-box fade-in" style="background: #FFF5E1; border-color: #FF6B6B;">
                    <div class="word-display" style="color: #FF6B6B;">${word.word}</div>
                    <div class="options">
                        ${options.map((opt, i) => `
                            <div class="option" style="background: #FF6B6B;" onclick="checkSpeedAnswer('${opt.word.replace(/'/g, "\\'")}', '${word.word.replace(/'/g, "\\'")}', this)">
                                ${opt.meaning}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            document.getElementById('speedGame').innerHTML = html;
        }

        function checkSpeedAnswer(selected, correct, element) {
            if (selected === correct) {
                element.classList.add('correct');
                score += 5;
                totalScore += 5;
                learnedWords.add(correct);
                masteredWords.add(correct);
                saveProgress();
                updateStats();
                currentQuestion++;
                setTimeout(() => showSpeedQuestion(), 300);
            } else {
                element.classList.add('incorrect');
                showToast('Wrong!', true);
                setTimeout(() => {
                    element.classList.remove('incorrect');
                }, 300);
            }
        }

        // Idioms Game
        function startIdiomsGame() {
            currentGame = 'idioms';
            gameWords = getRandomWords(20, 'idiom');
            currentQuestion = 0;
            document.getElementById('idiomsGame').classList.add('active');
            showIdiomQuestion();
        }

        function showIdiomQuestion() {
            if (currentQuestion >= gameWords.length) {
                showResults('idiomsGame');
                return;
            }

            const idiom = gameWords[currentQuestion];
            const wrongAnswers = getRandomWords(3, 'idiom').filter(w => w.word !== idiom.word);
            const options = shuffleArray([...wrongAnswers, idiom]);

            const html = `
                <div class="game-header">
                    <button class="brutalist-button secondary" onclick="showMenu()">‚Üê Back</button>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${(currentQuestion / gameWords.length) * 100}%"></div>
                        <div class="progress-text">${currentQuestion + 1} / ${gameWords.length}</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Score</div>
                        <div class="stat-value">${score}</div>
                    </div>
                </div>

                <div class="game-content brutalist-box fade-in" style="background: #E7F5FF;">
                    <div class="question">What does this idiom mean?</div>
                    <div class="word-display" style="color: #1971C2; font-size: 36px;">"${idiom.word}"</div>
                    <div class="options">
                        ${options.map((opt, i) => `
                            <div class="option" style="background: #74C0FC;" onclick="checkIdiomAnswer('${opt.word.replace(/'/g, "\\'")}', '${idiom.word.replace(/'/g, "\\'")}', this)">
                                ${opt.meaning}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            document.getElementById('idiomsGame').innerHTML = html;
        }

        function checkIdiomAnswer(selected, correct, element) {
            const options = document.querySelectorAll('#idiomsGame .option');
            options.forEach(opt => opt.classList.add('disabled'));

            if (selected === correct) {
                element.classList.add('correct');
                score += 10;
                totalScore += 10;
                learnedWords.add(correct);
                masteredWords.add(correct);
                showToast('Correct! +10 points');
            } else {
                element.classList.add('incorrect');
                showToast('Incorrect!', true);
            }

            saveProgress();
            updateStats();

            setTimeout(() => {
                currentQuestion++;
                showIdiomQuestion();
            }, 1500);
        }

        // Results
        function showResults(gameId) {
            const percentage = gameWords.length > 0 ? Math.round((score / (gameWords.length * 10)) * 100) : 0;
            let message = '';
            
            if (percentage >= 90) message = 'üèÜ Outstanding! You\'re a vocabulary master!';
            else if (percentage >= 70) message = 'üåü Great job! Keep up the good work!';
            else if (percentage >= 50) message = 'üëç Good effort! Practice makes perfect!';
            else message = 'üí™ Keep practicing! You\'ll get better!';

            const html = `
                <div class="game-content brutalist-box results">
                    <h2>Game Complete!</h2>
                    <div class="score">${score}</div>
                    <div class="message">${message}</div>
                    <div class="message">You learned ${currentQuestion} new words!</div>
                    <div class="game-actions">
                        <button class="brutalist-button" onclick="startGame('${currentGame}')">Play Again</button>
                        <button class="brutalist-button secondary" onclick="showMenu()">Main Menu</button>
                    </div>
                </div>
            `;

            document.getElementById(gameId).innerHTML = html;
        }

        // Daily Words Functions
        function initDailyWords() {
            if (!currentUser) return; // Don't init if no user
            
            const today = new Date().toDateString();
            
            if (dailyDate !== today) {
                // New day - generate new daily words
                dailyDate = today;
                generateDailyWords();
                saveProgress();
            } else if (dailyWords.length === 0) {
                // Same day but no words saved - generate
                generateDailyWords();
            }
        }

        function generateDailyWords() {
            // Get 10 random words that haven't been mastered yet
            const unmastered = vocabData.filter(v => !masteredWords.has(v.word));
            dailyWords = shuffleArray(unmastered).slice(0, 10);
            saveProgress();
        }

        function refreshDailyWords() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën refresh 10 t·ª´ m·ªõi? (Ti·∫øn ƒë·ªô h√¥m nay s·∫Ω b·ªã reset)')) {
                generateDailyWords();
                startDailyWordsGame();
                showToast('‚ú® ƒê√£ refresh 10 t·ª´ m·ªõi!');
            }
        }

        function startDailyWordsGame() {
            currentGame = 'daily';
            document.getElementById('dailyGame').classList.add('active');
            showDailyWords();
        }

        function showDailyWords() {
            const today = new Date().toLocaleDateString('vi-VN', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            const masteredToday = dailyWords.filter(w => masteredWords.has(w.word)).length;
            const totalWords = dailyWords.length;

            const html = `
                <div class="game-header">
                    <button class="brutalist-button secondary" onclick="showMenu()">‚Üê Back</button>
                    <div class="stat-box" style="background: #51CF66;">
                        <div class="stat-label">Today's Progress</div>
                        <div class="stat-value">${masteredToday}/${totalWords}</div>
                    </div>
                </div>

                <div class="game-content brutalist-box fade-in">
                    <div class="daily-header">
                        <div class="daily-date">üìÖ ${today}</div>
                        <div class="daily-progress">T·ª´ v·ª±ng h√¥m nay c·ªßa b·∫°n</div>
                    </div>

                    <div class="daily-stats">
                        <div class="daily-stat-card">
                            <div class="daily-stat-label">Mastered Today</div>
                            <div class="daily-stat-value">${masteredToday}</div>
                        </div>
                        <div class="daily-stat-card" style="background: #74C0FC;">
                            <div class="daily-stat-label">Remaining</div>
                            <div class="daily-stat-value">${totalWords - masteredToday}</div>
                        </div>
                        <div class="daily-stat-card" style="background: #51CF66;">
                            <div class="daily-stat-label">Total Mastered</div>
                            <div class="daily-stat-value">${masteredWords.size}</div>
                        </div>
                    </div>

                    <div class="word-cards">
                        ${dailyWords.map((word, index) => {
                            const isMastered = masteredWords.has(word.word);
                            return `
                                <div class="word-card ${isMastered ? 'mastered' : ''}" id="daily-word-${index}">
                                    <div class="word-card-header">
                                        <div class="word-card-word">${word.word}</div>
                                        <div class="word-card-type">${word.type}</div>
                                    </div>
                                    <div class="word-card-meaning">${word.meaning}</div>
                                    <div class="word-card-actions">
                                        <button class="mark-done-btn ${isMastered ? 'done' : ''}" 
                                                onclick="markWordAsMastered('${word.word.replace(/'/g, "\\'")}', ${index})">
                                            ${isMastered ? '‚úÖ Mastered' : '‚úì Mark as Done'}
                                        </button>
                                        <button class="practice-btn" 
                                                onclick="practiceWord('${word.word.replace(/'/g, "\\'")}')">
                                            üéØ Practice
                                        </button>
                                        <span class="status-badge">${isMastered ? 'üåü' : 'üìñ'}</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <button class="refresh-daily-btn" onclick="refreshDailyWords()">
                        üîÑ Refresh Daily Words
                    </button>
                </div>
            `;

            document.getElementById('dailyGame').innerHTML = html;
        }

        function markWordAsMastered(word, index) {
            masteredWords.add(word);
            learnedWords.add(word);
            totalScore += 20; // Bonus for mastering a word
            
            saveProgress();
            updateStats();
            
            // Update UI
            const card = document.getElementById(`daily-word-${index}`);
            card.classList.add('mastered');
            
            const button = card.querySelector('.mark-done-btn');
            button.textContent = '‚úÖ Mastered';
            button.classList.add('done');
            
            const badge = card.querySelector('.status-badge');
            badge.textContent = 'üåü';
            
            // Update stats
            const masteredToday = dailyWords.filter(w => masteredWords.has(w.word)).length;
            const statValue = document.querySelector('.stat-box .stat-value');
            if (statValue) {
                statValue.textContent = `${masteredToday}/${dailyWords.length}`;
            }
            
            // Update daily stats
            const masteredTodayCard = document.querySelector('.daily-stat-card .daily-stat-value');
            if (masteredTodayCard) {
                masteredTodayCard.textContent = masteredToday;
            }
            
            const remaining = document.querySelectorAll('.daily-stat-card')[1].querySelector('.daily-stat-value');
            if (remaining) {
                remaining.textContent = dailyWords.length - masteredToday;
            }
            
            const totalMastered = document.querySelectorAll('.daily-stat-card')[2].querySelector('.daily-stat-value');
            if (totalMastered) {
                totalMastered.textContent = masteredWords.size;
            }
            
            showToast(`‚ú® Mastered "${word}"! +20 points`);
            
            // Celebration if all done
            if (masteredToday === dailyWords.length) {
                setTimeout(() => {
                    showToast('üéâ Congratulations! You mastered all daily words!');
                }, 500);
            }
        }

        function practiceWord(word) {
            const wordObj = vocabData.find(w => w.word === word);
            if (!wordObj) return;
            
            const wrongAnswers = getRandomWords(3, wordObj.type).filter(w => w.word !== word);
            const options = shuffleArray([...wrongAnswers, wordObj]);
            
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                padding: 20px;
            `;
            
            overlay.innerHTML = `
                <div class="game-content brutalist-box" style="max-width: 600px; width: 100%; margin: 0;">
                    <div class="question">Practice: What does this word mean?</div>
                    <div class="word-display">${word}</div>
                    <div class="options">
                        ${options.map((opt, i) => `
                            <div class="option" onclick="checkPracticeAnswer('${opt.word.replace(/'/g, "\\'")}', '${word.replace(/'/g, "\\'")}', this)">
                                ${opt.meaning}
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="brutalist-button secondary" onclick="this.closest('[style*=\\'position: fixed\\']').remove()">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
        }

        function checkPracticeAnswer(selected, correct, element) {
            const options = element.parentElement.querySelectorAll('.option');
            options.forEach(opt => opt.classList.add('disabled'));
            
            if (selected === correct) {
                element.classList.add('correct');
                showToast('Correct! üéâ');
                setTimeout(() => {
                    element.closest('[style*="position: fixed"]').remove();
                }, 1500);
            } else {
                element.classList.add('incorrect');
                options.forEach(opt => {
                    const vocabItem = vocabData.find(v => v.word === correct);
                    if (vocabItem && opt.textContent.trim() === vocabItem.meaning) {
                        opt.classList.add('correct');
                    }
                });
                showToast('Try again!', true);
            }
        }
    </script>
</body>
</html>
